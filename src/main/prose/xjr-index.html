<html>
<!-- 
This work is released into the Public Domain under the
terms of the Creative Commons CC0 1.0 Universal license.
https://creativecommons.org/publicdomain/zero/1.0/
-->
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="pityoulish.css" />
<title>Exercise: Message Board Client with Java RMI </title>
</head>
<body>
<h1 id="exercise" class="title">
  <span>Exercise: Message Board Client with Java RMI</span>
</h1>
<p class="abstract">
During this exercise, you will enjoy the convenience,
gape at the limitations, and curse the intricacies
of remote method invocation.
</p>

<div class="larger">
<p>
Your task is to find and fix errors in two Java programs.
The first one is a <a href="message-board.html">Message Board</a> client
using Java Remote Method Invocation.
This allows for a direct comparison with the Message Board client
using sockets from a previous exercise.
The second program sends and receives
<a href="direct-messages.html">Direct Messages</a>.
This exposes the callee side of remote invocations.
</p>

<p>
A recipe for solving this task has been conveyed beforehand in a Tutorial.
It was applied in a previous exercise with sockets in Java.
The development steps are assumed to be known by now.
</p>

<ol>
<li><a href="#setup">Setup</a> before you begin</li>
<li><a href="#part1-mbclient">Message Board Client</a>, the first part</li>
<li><a href="#part2-dmoutlet">Direct Message Outlet</a>, the second part</li>
<li><a href="#code">Code Overview</a> for both parts</li>
<li><a href="#learned">Lessons Learned</a> when done</li>
</ol>

</div>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h2 id="setup"><span>Setup</span></h2>
<!--h2 id="prepare"><span>Prepare</span></h2-->

<p>
You already set up a Java development environment in the Tutorial.
Editor, Java compiler and tools, maybe an IDE, are readily available.
Good.
</p>

<p>
You already know how to access the instructions for this exercise,
because you're reading them. Good.
Other useful things you could open in separate browser tabs are
the Java Platform API specification (aka standard JavaDocs)
and the Tutorial instructions.
Where to find either depends on the network setup.
</p>

<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h3 id="connectivity"><span>Network</span></h3>

<p>
Connect your computer to the network with the server, if you have not
done so already. The instructor provides all necessary information,
along with the following:
</p>
<ul>
<li>IP address and port number of the RMI Registry on the server.
  A hostname may replace the IP address.</li>
<li>URL to the Java Platform API JavaDocs,
  if the network is isolated from the Internet.</li>
<li>URL to this exercise, optionally.</li>
<li>URL to the Tutorial, optionally.</li>
<li>URL to the exercise with sockets, optionally.</li>
</ul>



<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h2 id="part1-mbclient"><span>Message Board Client</span></h2>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<h3 id="client-program"><span>Client</span></h3>
 -->

<div class="box-right">
<dl>
<dt><a href="mbclient-jrmi-faulty.jar"
       ><code>mbclient-jrmi-faulty.jar</code></a></dt>
<dd>The first program to test and fix. Usage instructions:
  <br/><code>&nbsp;&nbsp;java -jar mbclient-jrmi-faulty.jar</code><br/>
  Sources are in the jar,
  <a href="jdoc/index.html" target="_blank">docs</a> here.
</dd>
</dl>
</div><!-- box-right -->

<p>
Download the client program, <a href="mbclient-jrmi-faulty.jar"
                        ><code>mbclient-jrmi-faulty.jar</code></a>,
and give it a decent filename.
</p>

<p>
Run the client without arguments to obtain the usage instructions.
Read and understand those.
The high-level description of the
<a href="message-board.html">Message Board</a>
should be familiar from a previous exercise.
The client supports exactly the same commands as the client with sockets.
</p>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h3 id="client-sequence"><span>Test Sequence</span></h3>

<p>
You can re-use your test sequence from the previous exercise
about the Message Board Client with sockets.
For example:
</p>
<ol>
<li>
List messages from the board, without marker.
</li>
<li>
Obtain a ticket.
</li>
<li>
Put some messages on the board.
</li>
<li>
List messages again, with and without marker.
Use different markers.
</li>
<li>
Return a ticket.
Use it again afterwards, to verify that it is no longer valid.
</li>
<li>
Replace a ticket, before and after exhausting all operations.
</li>
</ol>

<p>
There are three problems to find and fix.
</p>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h2 id="part2-dmoutlet"><span>Direct Message Outlet</span></h2>

<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<h3 id="outlet-program"><span>Outlet</span></h3>
-->

<div class="box-right">
<dl>
<dt><a href="dmoutlet-jrmi-faulty.jar"
       ><code>dmoutlet-jrmi-faulty.jar</code></a></dt>
<dd>The second program to test and fix. Usage instructions:
  <br/><code>&nbsp;&nbsp;java -jar dmoutlet-jrmi-faulty.jar</code><br/>
  Sources are in the jar,
  <a href="jdoc/index.html" target="_blank">docs</a> here.
</dd>
</dl>
</div><!-- box-right -->

<p>
Download the outlet program, <a href="dmoutlet-jrmi-faulty.jar"
                        ><code>dmoutlet-jrmi-faulty.jar</code></a>,
and give it a decent filename.
</p>

<p>
Run the program without arguments to obtain the usage instructions.
Read and understand those.
Compare the supported operations with the high-level description
of <a href="direct-messages.html">Direct Messages</a>.
For obtaining tickets, use the Message Board client above.
</p>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h3 id="outlet-sequence"><span>Test Sequence</span></h3>

<p>
The outlet program supports two modes of operation.
On one hand, it can open an outlet and wait for direct messages.
On the other hand, it can make a remote call to an outlet or outlet manager.
For cooperation with your fellow students, please open an outlet
as soon as possible and keep it open while you work on the remote calls.
Last but not least, cleanup is required when closing an outlet.
For example, use the following test sequence:
</p>
<ol>
<li>
Open an outlet, with a timespan of several minutes.
When that works, run the program in a dedicated terminal and
keep the outlet open for the remainder of the programming session,
or at least until you get to the cleanup part. Check the terminal
once in a while for direct messages from other students or the instructor.
</li>
<li>
List the usernames for published outlets.
Expect to see your own, maybe that of the instructor, and
those of other students that managed to open an outlet.
</li>
<li>
Send direct messages to the published outlets:
a single recipient, a list of recipients, or * for everyone.
Expect to deal with errors, because outlets may close
without removing their entry from the directory.
</li>
<li>
Unpublish your own outlet, before or after stopping
the program running in a dedicated terminal.
</li>
<li>
Open an outlet, for a few seconds only.
Make sure that the program closes the outlet and exits cleanly.
Note the difference between closing the outlet and unpublishing it.
</li>
<li>
Can you open more than one outlet at a time?
</li>
</ol>

<p>
There are four problems to fix in the code.
There are numerous problems in the application architecture,
but those are not the topic of this exercise.
</p>



<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h2 id="code"><span>Code Overview</span></h2>

<p>
There is one set of <a href="jdoc/index.html" target="_blank">JavaDocs</a>
for both parts of the exercise. It is split into four groups.
The last group comprises support packages which are already known from
the Tutorial. The other packages are briefly described here.
</p>

<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h3 id="code-RemoteAPI"><span>Remote API</span></h3>

<p>
The Remote API in <code>pityoulish.jrmi.api</code> defines the glue
which keeps clients and server, outlets and senders together.
There are four interfaces for remotely callable objects,
they extend <code>java.rmi.Remote</code>.
Three of them are named <code>Remote*</code>, their objects will be
running on the server and can be looked up in the RMI registry.
The lookup names are defined by an enum, <code>RegistryNames</code>.
The fourth interface is <code>DirectMessageOutlet</code>,
its objects will be running on the machines of all the participants.
</p>

<p>
The remaining two interfaces in the Remote API describe
data that is passed in remote calls.
They extend <code>java.io.Serializable</code>, and
there are implementation classes in the Remote API.
This ensures that all participants can deserialize the objects.
Finally, the <code>APIException</code> is for reporting errors.
It is intentionally not derived from <code>java.rmi.RemoteException</code>,
to clearly distinguish Java RMI problems from application problems.
</p>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h3 id="code-MessageBoard"><span>Message Board Client</span></h3>

<p>
Package <code>pityoulish.jrmi.client</code>
contains the client for the Message Board.
From the Remote API, it relies on
<code>RemoteMessageBoard</code>, <code>RemoteTicketIssuer</code>,
and the data representation of
<code>MessageList</code> and <code>MessageItem</code>.
Package <code>pityoulish.mbclient</code> is familiar from a previous exercise.
Commands are delegated to a <code>MsgBoardClientHandler</code>,
backend arguments recorded by a <code>HostPortBackendHandler</code>.
The <code>.client</code> package extends the backend handler with
some lookup methods.
A <code>DataFormatter</code> is responsible for printing data
obtained from the server.
Each of the interfaces has a single implementation class.
</p>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h3 id="code-DirectMessages"><span>Direct Messages</span></h3>

<p>
Package <code>pityoulish.jrmi.outlet</code>
contains the logic for sending and receiving Direct Messages.
From the Remote API, it relies on
<code>RemoteOutletManager</code> and <code>DirectMessageOutlet</code>.
The former is provided by the server,
the latter both implemented and called by this package.
<code>Main</code>, <code>MsgOutletCommandDispatcher</code>,
and <code>RegistryBackendHandler</code>
are similar to the Message Board client above.
</p>

<p>
<code>DirectMessageOutletImpl</code> is a simple implementation of an outlet.
Besides argument checking, it merely prints invocations and their arguments
to the console.
The commands supported by the program are delegated to a
<code>MsgOutletHandler</code>, which has a single implementation class.
</p>


<p>
Logically, Direct Messages require the same ticket-related operations as
the Message Board client. To avoid code duplication, those commands which
call the <code>RemoteTicketIssuer</code> are not implemented here again.
Instead, use the Message Board client to obtain tickets.
</p>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h2 id="learned"><span>Lessons Learned</span></h2>

<p>
Did you get through both test sequences in time?
If not, where or how did you lose time?
</p>

<p>
How do you like coding on this level?
Compare to the exercise with sockets.
</p>

<p>
Which security gaps did you spot during the exercise?
Should those be addressed by the application, or by Java RMI?
</p>


<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<h3 id="gimme-more"><span>Want some more?</span></h3>

<!--
Is there a sensible programming task in this context?
A long-running client, like for the sockets exercise, seems too dull.
-->

<p>
This exercise is from <i>Pityoulish</i>,
an Open Source project hosted on GitHub.
<!-- Intentionally not linked here...
     https://github.com/rolandweber/pityoulish/
     Don't want to point students there during the exercise :-)
-->
If you want to help, you can submit Pull Requests
with improvements to the instructions or the code.
Among the Issues is a selection of smaller and bigger implementation tasks,
tagged with "help wanted". Most of them are about coding, but you can also
help with translations, by proof-reading, inventing new exercises, and more.
</p>


</body>
</html>

